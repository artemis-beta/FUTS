CMAKE_MINIMUM_REQUIRED(VERSION 3.12)

PROJECT(FUTS)

ENABLE_LANGUAGE(Fortran)

FILE(GLOB FUTF_SRCS ${CMAKE_SOURCE_DIR}/src/*.f90)

IF(NOT CMAKE_Fortran_COMPILER)
    SET(CMAKE_Fortran_COMPILER gfortran)
ENDIF()

OPTION(BUILD_TESTS "Build the FUTS Unit Tests" OFF)
OPTION(BUILD_EXAMPLES "Build the FUTS Example Project" OFF)

ADD_LIBRARY(${PROJECT_NAME} ${FUTF_SRCS})

SET_TARGET_PROPERTIES(
        ${PROJECT_NAME}
        PROPERTIES
        Fortran_MODULE_DIRECTORY ${CMAKE_BINARY_DIR}/modules
    )

IF(BUILD_TESTS)
        INCLUDE(${CMAKE_SOURCE_DIR}/cmake/fortutf.cmake)
	SET(TEST_DIR ${CMAKE_SOURCE_DIR}/tests)
	SET(SRC_FILES ${FUTF_SRCS})
        FortUTF_Find_Tests()
ENDIF()

IF(BUILD_EXAMPLES)
    ADD_SUBDIRECTORY(${CMAKE_SOURCE_DIR}/examples/demo_project)
ENDIF()
 
SET_TARGET_PROPERTIES(
    ${PROJECT_NAME}
    PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin"
)
SET_TARGET_PROPERTIES(
    ${PROJECT_NAME}
    PROPERTIES
    Fortran_MODULE_DIRECTORY ${CMAKE_BINARY_DIR}/modules
)
